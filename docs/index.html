---

title: NIFI REST API


keywords: fastai
sidebar: home_sidebar

summary: "Automates the Nifi dataflows "
description: "Automates the Nifi dataflows "
nb_path: "nbs/index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Dataflows can be fully automated using the Nifi API. This project taps and un-taps a dataflow by tracking the incoming/outgoing flowfiles.</p>
<p>More specifically, it turns on an <em>initial processor</em> and records the flowfiles generated by inspecting an <em>incoming connection</em>. After this, a <em>middle processor</em> is turned on. When all the flowfiles are registered in a <em>outcoming connection</em>, a <em>final processor</em> is turned on. Before finishing, it returns the pipeline to its initial state.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-is-automated?">What is automated?<a class="anchor-link" href="#What-is-automated?"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following example represents  the actions on the dataflow that get automated by the <strong>nifi_api</strong> library.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>The initial state of the dataflow:</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/nifi_api/images/1_dataflow.png" alt="image.png" title=" initial state"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Turn on the "Initial" processor and turn off the "Final" processor:</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/nifi_api/images/2_dataflow.png" alt="Initial State" title=" middle state"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Turn off the "Initial" processor and record the flowfiles in the "Initial" connection, then turn on the "Middle" processor:</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/nifi_api/images/3_dataflow.png" alt="Initial State" title=" final state"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Record the flowfiles in the "Final" Connection, when they coincide with the "Initial" flowfile turn off the "Middle" processor and turn on the "Final" processor.</li>
<li>The flowfiles in the "Final" connection get consumed by the "Final" processor and the initial state of the dataflow is recovered.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is a recording of the Nifi UI when the tool is being executed on this dataflow:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/nifi_api/images/automated_dataflow.gif" alt="image.gif" title="animation"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Environment">Environment<a class="anchor-link" href="#Environment"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Nifi cluster used for testing is in the <em>Cloudera Public Cloud</em> and needs basic authentication credentials for accessing. The following environmental variables are necessary to access the cluster:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>  - CLOUDERA_USER=user
  - CLOUDERA_PASS=password
  - CLOUDERA_CLUSTER=https://&lt;url_clustername&gt;.cloudera.site/&lt;clustername&gt;
  - CLOUDERA_NIFI_REST=/cdp-proxy-api/nifi-app/nifi-api/</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a <code>pip</code> installation run:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install nifi-api</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider the template <code>Test_API.json</code> in the root folder, this is the template used in <code>What automates?</code> section.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Write the data structure with the Nifi Ids (located in <em>view configuration -&gt; settings -&gt; Id</em>) of the processors and connections:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nifi_api.environment</span> <span class="kn">import</span> <span class="n">DataFlowIds</span>
<span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;in_connection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;cc549c6e-0177-1000-ffff-ffffb5d2aba2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;First&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;out_connection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;51ab3b24-084f-1309-0000-00001946f2c7&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Final&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;in_processor&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;36c62ad6-d606-3b04-9743-d77b6249608c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;First&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;middle_processor&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;cc54862f-0177-1000-ffff-ffffe7325a20&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Middle&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;out_processor&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;51ab3b1e-084f-1309-a135-aa0100d7186b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Final&quot;</span>
    <span class="p">},</span>
<span class="p">}</span>
<span class="n">data_ids</span> <span class="o">=</span> <span class="n">DataFlowIds</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instantiate and run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nifi_api.dataflow</span> <span class="kn">import</span> <span class="n">DataFlow</span>
<span class="n">dataflow</span> <span class="o">=</span> <span class="n">DataFlow</span><span class="p">(</span>
    <span class="n">dataflow_ids</span><span class="o">=</span><span class="n">data_ids</span><span class="p">,</span>
    <span class="n">delay_seconds_after_start</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">delay_seconds_between_checks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>pipeline watching has started..
Pipeline watching has finished ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

